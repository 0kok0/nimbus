# Nimbus
# Copyright (c) 2018 Status Research & Development GmbH
# Licensed under either of
#  * Apache License, version 2.0, ([LICENSE-APACHE](LICENSE-APACHE) or http://www.apache.org/licenses/LICENSE-2.0)
#  * MIT license ([LICENSE-MIT](LICENSE-MIT) or http://opensource.org/licenses/MIT)
# at your option. This file may not be copied, modified, or distributed except according to those terms.

# XXX: when all but a relative few dozen, say, GeneralStateTests run, remove this,
# but for now, this enables some CI use before that to prevent regressions. In the
# separate file here because it would otherwise just distract. Could use all sorts
# of O(1) or O(log n) lookup structures, or be more careful to only initialize the
# table once, but notion's that it should shrink reasonable quickly and disappear,
# being mostly used for short-term regression prevention.
func allowedFailingGeneralStateTest*(folder, name: string): bool =
  let allowedFailingGeneralStateTests = @[
    "randomStatetest14.json", # SHA3 offset
    "randomStatetest85.json", # CALL* memoffset

    "returndatacopy_0_0_following_successful_create.json", # CRASH
    "CreateOOGafterInitCodeReturndata2.json", # CRASH

    "returndatasize_after_failing_delegatecall.json",
    "ecmul_1-3_2_28000_96.json",
    "RevertInStaticCall.json",
    "modexp_3_09984_39936_25000.json",
    "ecadd_0-0_1-3_25000_128.json",
    "modexpRandomInput.json",
    "ecmul_0-3_2_28000_128.json",
    "ecmul_0-3_5616_28000_128.json",
    "ecadd_1-2_0-0_21000_192.json",
    "static_RevertOpcodeCalls.json",
    "modexp_9_37111_37111_1000000.json",
    "ecmul_1-3_1_21000_96.json",
    "ecmul_1-3_340282366920938463463374607431768211456_28000_80.json",
    "ecmul_1-2_9935_21000_128.json",
    "ecmul_0-0_0_21000_0.json",
    "ecmul_1-3_0_28000_96.json",
    "ecadd_0-0_0-0_21000_64.json",
    "ecmul_1-3_5616_28000_128.json",
    "ecmul_0-0_9_28000_128.json",
    "ecmul_0-3_9_28000_96.json",
    "ecmul_7827-6598_2_28000_128.json",
    "ecmul_0-0_0_28000_64.json",
    "ecmul_7827-6598_9_21000_96.json",
    "ecmul_0-3_1_28000_96.json",
    "ecmul_0-3_2_21000_96.json",
    "ecmul_0-3_5617_21000_128.json",
    "ecmul_0-0_5617_28000_128.json",
    "returndatasize_after_failing_callcode.json",
    "modexp_3_5_100_25000.json",
    "ecmul_1-2_2_28000_128.json",
    "ecmul_7827-6598_1456_28000_96.json",
    "ecadd_1-3_0-0_25000_80.json",
    "ecadd_1145-3932_2969-1336_25000_128.json",
    "ecmul_1-2_9935_21000_96.json",
    "pointAddTrunc.json",
    "modexp_3_09984_39936_155000.json",
    "sec80.json",
    "modexp_37120_37111_0_1000000.json",
    "RevertOpcodeInCallsOnNonEmptyReturnData.json",
    "ecmul_7827-6598_1456_21000_96.json",
    "ecmul_0-3_9_28000_128.json",
    "ecadd_6-9_19274124-124124_21000_128.json",
    "ecadd_0-0_0-0_21000_192.json",
    "ecpairing_one_point_insufficient_gas.json",
    "modexp.json",
    "ecmul_0-0_5617_21000_96.json",
    "ecmul_0-3_2_21000_128.json",
    "ecmul_7827-6598_1_28000_96.json",
    "modexp_55190_55190_42965_20500.json",
    "ecmul_1-3_0_21000_64.json",
    "ecmul_7827-6598_1456_21000_80.json",
    "ecadd_1145-3932_1145-4651_21000_192.json",
    "ecpairing_two_point_match_4.json",
    "modexp_39936_1_55201_20500.json",
    "ecmul_0-3_9935_21000_128.json",
    "ecpairing_one_point_with_g2_zero_and_g1_invalid.json",
    "modexp_55190_55190_42965_22000.json",
    "ecmul_7827-6598_0_28000_96.json",
    "RevertInCreateInInit.json",
    "pointMulAdd2.json",
    "ecmul_7827-6598_2_21000_96.json",
    "ecadd_0-0_0-0_25000_64.json",
    "ecmul_0-3_0_28000_128.json",
    "ecmul_0-3_1_21000_128.json",
    "ecpairing_two_point_fail_1.json",
    "ecmul_7827-6598_0_28000_80.json",
    "ecmul_7827-6598_2_21000_128.json",
    "returndatacopy_following_call.json",
    "ecadd_0-0_1-2_21000_192.json",
    "ecadd_1145-3932_2969-1336_21000_128.json",
    "returndatacopy_after_revert_in_staticcall.json",
    "ecmul_7827-6598_9935_21000_96.json",
    "ecmul_7827-6598_9_28000_128.json",
    "ecmul_0-3_9935_21000_96.json",
    "ecmul_0-3_340282366920938463463374607431768211456_28000_96.json",
    "ecpairing_perturb_zeropoint_by_curve_order.json",
    "ecmul_0-0_0_21000_40.json",
    "ecmul_1-2_0_21000_80.json",
    "modexp_55190_55190_42965_25000.json",
    "ecmul_1-2_1_28000_96.json",
    "ecmul_1-3_9_21000_128.json",
    "ecmul_0-0_9935_21000_128.json",
    "modexp_3_09984_39936_35000.json",
    "ecmul_1-3_9935_28000_96.json",
    "modexp_49_2401_2401_20500.json",
    "ecmul_0-0_0_21000_128.json",
    "ecmul_1-2_1_28000_128.json",
    "ecmul_1-2_340282366920938463463374607431768211456_28000_128.json",
    "ecmul_0-0_2_28000_96.json",
    "modexp_49_2401_2401_25000.json",
    "ecmul_1-3_1_28000_128.json",
    "ecmul_7827-6598_5616_28000_128.json",
    "ecadd_0-0_1-2_25000_128.json",
    "modexp_3_09984_39936_22000.json",
    "ecmul_1-2_9_28000_96.json",
    "modexp_55190_55190_42965_155000.json",
    "RevertOpcodeDirectCall.json",
    "ecmul_1-2_0_28000_64.json",
    "modexp_39936_1_55201_1000000.json",
    "ecmul_1-2_2_28000_96.json",
    "ecmul_1-2_340282366920938463463374607431768211456_28000_80.json",
    "PythonRevertTestTue201814-1430.json",
    "ecmul_1-2_5616_21000_128.json",
    "ecmul_1-2_616_28000_96.json",
    "modexp_3_5_100_22000.json",
    "returndatacopy_following_revert_in_create.json",
    "ecmul_7827-6598_5617_28000_128.json",
    "ecmul_1-2_0_28000_128.json",
    "ecmul_1-3_5617_21000_128.json",
    "RevertInCallCode.json",
    "ecmul_1-2_5617_28000_96.json",
    "ecmul_7827-6598_1_21000_128.json",
    "ecmul_1-2_5616_21000_96.json",
    "ecpairing_one_point_with_g2_zero.json",
    "ecpairing_perturb_g2_by_field_modulus.json",
    "ecmul_1-3_9_28000_128.json",
    "ecmul_7827-6598_1456_28000_80.json",
    "modexp_37120_37111_1_1000000.json",
    "ecmul_0-0_9935_21000_96.json",
    "pointMulAdd.json",
    "ecmul_7827-6598_5617_21000_96.json",
    "ecmul_7827-6598_5617_28000_96.json",
    "ecpairing_three_point_match_1.json",
    "ecmul_1-3_2_21000_96.json",
    "ecmul_0-3_9_21000_128.json",
    "RevertOpcodeReturn.json",
    "ecmul_0-0_5617_21000_128.json",
    "modexp_49_2401_2401_22000.json",
    "modexp_3_5_100_35000.json",
    "ecmul_1-2_5617_21000_96.json",
    "ecadd_0-0_0-0_25000_0.json",
    "ecadd_1-2_0-0_21000_64.json",
    "modexp_3_5_100_1000000.json",
    "ecmul_0-3_5617_21000_96.json",
    "ecmul_7827-6598_1456_28000_128.json",
    "ecmul_0-0_1_21000_128.json",
    "ecmul_7827-6598_0_28000_128.json",
    "Opcodes_TransactionInit.json",
    "ecmul_7827-6598_0_21000_80.json",
    "ecadd_0-0_1-2_25000_192.json",
    "ecmul_0-3_340282366920938463463374607431768211456_28000_128.json",
    "ecadd_0-0_0-0_25000_80.json",
    "ecmul_0-3_9935_28000_96.json",
    "ecmul_0-0_5616_28000_96.json",
    "ecpairing_two_point_oog.json",
    "ecmul_0-3_0_28000_64.json",
    "ecadd_0-3_1-2_25000_128.json",
    "ecmul_0-0_9935_28000_128.json",
    "modexp_3_09984_39936_1000000.json",
    "ecmul_0-0_1_21000_96.json",
    "modexp_49_2401_2401_1000000.json",
    "ecadd_0-0_1-3_21000_128.json",
    "ecmul_0-0_9_21000_96.json",
    "ecmul_1-2_2_21000_128.json",
    "RevertOnEmptyStack.json",
    "ZeroValue_TransactionCALLwithData_ToOneStorageKey_OOGRevert.json",
    "ecmul_1-3_340282366920938463463374607431768211456_21000_80.json",
    "ecmul_0-0_0_28000_96.json",
    "ecmul_1-2_340282366920938463463374607431768211456_21000_96.json",
    "ecmul_0-0_9_21000_128.json",
    "ecmul_0-0_5617_28000_96.json",
    "ecmul_0-3_0_21000_128.json",
    "ecmul_7827-6598_9935_28000_96.json",
    "modexp_3_28948_11579_20500.json",
    "ecmul_0-0_0_21000_96.json",
    "modexp_49_2401_2401_155000.json",
    "ecmul_1-2_340282366920938463463374607431768211456_21000_128.json",
    "ecmul_1-3_0_21000_96.json",
    "ecmul_0-0_5616_21000_128.json",
    "ecadd_1-2_0-0_25000_128.json",
    "ecmul_7827-6598_0_28000_64.json",
    "ecmul_7827-6598_1_28000_128.json",
    "ecmul_0-3_1_21000_96.json",
    "ecmul_0-0_340282366920938463463374607431768211456_28000_96.json",
    "ecmul_0-3_5616_21000_96.json",
    "ecmul_0-3_340282366920938463463374607431768211456_21000_96.json",
    "ZeroValue_TransactionCALLwithData_ToEmpty_OOGRevert.json",
    "ecpairing_perturb_g2_by_one.json",
    "txCost-sec73.json",
    "ecmul_1-3_0_21000_80.json",
    "ecadd_1-2_1-2_21000_192.json",
    "ecmul_0-0_2_28000_128.json",
    "ecmul_0-0_340282366920938463463374607431768211456_21000_96.json",
    "modexp_55190_55190_42965_1000000.json",
    "static_CallEcrecover0_0input.json",
    "ecmul_1-2_340282366920938463463374607431768211456_21000_80.json",
    "ecmul_1-3_9935_28000_128.json",
    "ecmul_7827-6598_0_21000_64.json",
    "returndatacopy_after_successful_delegatecall.json",
    "ecpairing_empty_data.json",
    "ecmul_0-0_1_28000_128.json",
    "modexp_55190_55190_42965_35000.json",
    "ecmul_1-2_5616_28000_128.json",
    "RevertInDelegateCall.json",
    "ecmul_0-3_1_28000_128.json",
    "returndatacopy_afterFailing_create.json",
    "CreateOOGafterInitCodeRevert2.json",
    "ecmul_1-2_0_28000_80.json",
    "modexp_3_5_100_20500.json",
    "ZeroValue_TransactionCALL_ToEmpty_OOGRevert.json",
    "ecmul_1-2_5617_28000_128.json",
    "ecadd_0-3_1-2_21000_128.json",
    "returndatacopy_after_successful_callcode.json",
    "ecmul_1-3_1_21000_128.json",
    "ecmul_1-3_1_28000_96.json",
    "ecmul_1-3_9935_21000_128.json",
    "ecmul_7827-6598_5616_21000_96.json",
    "ecadd_1-2_0-0_21000_128.json",
    "ecmul_0-0_5616_28000_128.json",
    "ecadd_1145-3932_1145-4651_25000_192.json",
    "ecmul_0-3_5616_28000_96.json",
    "ecmul_1-2_2_21000_96.json",
    "ecmul_7827-6598_9_28000_96.json",
    "ecmul_0-0_5616_21000_96.json",
    "ecmul_1-3_5617_21000_96.json",
    "returndatasize_initial_zero_read.json",
    "ecpairing_perturb_zeropoint_by_one.json",
    "ecmul_0-0_340282366920938463463374607431768211456_21000_128.json",
    "ecmul_1-3_5616_21000_96.json",
    "ecmul_1-2_0_21000_96.json",
    "modexp_39936_1_55201_35000.json",
    "ecpairing_perturb_g2_by_curve_order.json",
    "RevertOpcodeCreate.json",
    "ecadd_1-2_1-2_25000_192.json",
    "ecmul_0-0_9_28000_96.json",
    "ecmul_7827-6598_2_28000_96.json",
    "ecpairing_two_point_match_3.json",
    "ecpairing_bad_length_193.json",
    "ecmul_7827-6598_9935_28000_128.json",
    "ecpairing_two_point_match_2.json",
    "ecmul_1-3_0_28000_64.json",
    "randomStatetest642.json",
    "ecpairing_three_point_fail_1.json",
    "ecmul_1-3_5617_28000_128.json",
    "ecadd_1-2_1-2_21000_128.json",
    "ecmul_7827-6598_9935_21000_128.json",
    "ecmul_0-0_9935_28000_96.json",
    "ecmul_0-3_340282366920938463463374607431768211456_28000_80.json",
    "ecmul_1-3_0_28000_80.json",
    "ecadd_6-9_19274124-124124_25000_128.json",
    "ecadd_0-0_0-0_21000_80.json",
    "ecmul_0-0_0_21000_64.json",
    "ecmul_0-0_0_28000_80.json",
    "ecmul_0-0_2_21000_96.json",
    "ecmul_0-3_0_21000_96.json",
    "RevertOpcodeMultipleSubCalls.json",
    "modexp_39936_1_55201_155000.json",
    "ecmul_0-0_340282366920938463463374607431768211456_21000_80.json",
    "ecmul_1-2_9935_28000_96.json",
    "ecmul_0-0_0_28000_0.json",
    "ecadd_1-3_0-0_21000_80.json",
    "ecadd_0-0_0-0_21000_0.json",
    "modexp_49_2401_2401_35000.json",
    "sha3_deja.json",
    "ecmul_0-0_340282366920938463463374607431768211456_28000_128.json",
    "ecmul_1-2_0_28000_96.json",
    "ecadd_0-0_0-0_21000_128.json",
    "ecmul_1-3_340282366920938463463374607431768211456_28000_96.json",
    "ecmul_1-2_9935_28000_128.json",
    "ecpairing_one_point_with_g1_zero.json",
    "ecmul_0-0_0_21000_80.json",
    "RevertOpcodeCalls.json",
    "ecadd_1-2_0-0_25000_192.json",
    "returndatacopy_following_revert.json",
    "ecmul_1-3_5617_28000_96.json",
    "modexp_39936_1_55201_25000.json",
    "ecmul_1-2_0_21000_64.json",
    "modexp_37120_37111_97_1000000.json",
    "ecmul_1-3_340282366920938463463374607431768211456_21000_128.json",
    "ecpairing_two_point_match_5.json",
    "ecmul_7827-6598_0_21000_96.json",
    "ecmul_7827-6598_5616_21000_128.json",
    "returndatasize_after_failing_staticcall.json",
    "ecadd_1-2_1-2_25000_128.json",
    "ecpairing_perturb_g2_by_field_modulus_again.json",
    "ecmul_0-3_5617_28000_128.json",
    "ecmul_0-3_340282366920938463463374607431768211456_21000_128.json",
    "ecmul_0-3_0_21000_64.json",
    "ecmul_1-2_9_28000_128.json",
    "ecadd_0-0_0-0_25000_192.json",
    "ecmul_0-0_2_21000_128.json",
    "modexp_3_5_100_155000.json",
    "returndatacopy_after_successful_staticcall.json",
    "ecmul_1-3_0_28000_128.json",
    "ecmul_0-3_0_21000_80.json",
    "ecmul_1-3_9935_21000_96.json",
    "ecmul_0-3_0_28000_96.json",
    "ecmul_1-3_2_21000_128.json",
    "ecmul_7827-6598_1_21000_96.json",
    "ecpairing_empty_data_insufficient_gas.json",
    "CreateOOGafterInitCodeRevert.json",
    "ecmul_0-0_1_28000_96.json",
    "RevertOpcode.json",
    "ecmul_0-3_5616_21000_128.json",
    "ecmul_1-2_9_21000_96.json",
    "ecmul_7827-6598_1456_21000_128.json",
    "ecmul_0-3_0_28000_80.json",
    "ecmul_7827-6598_9_21000_128.json",
    "CreateOOGafterInitCodeReturndataSize.json",
    "ecmul_0-0_0_28000_128.json",
    "RevertOpcodeInInit.json",
    "ecmul_1-2_1_21000_96.json",
    "ecmul_1-3_0_21000_128.json",
    "ecpairing_bad_length_191.json",
    "ecmul_7827-6598_5617_21000_128.json",
    "ecpairing_one_point_not_in_subgroup.json",
    "ecpairing_two_points_with_one_g2_zero.json",
    "ecadd_1-2_0-0_25000_64.json",
    "ecmul_0-0_0_28000_40.json",
    "ecmul_1-3_9_21000_96.json",
    "ecadd_0-0_0-0_25000_128.json",
    "ecmul_1-3_340282366920938463463374607431768211456_28000_128.json",
    "pointAdd.json",
    "pairingTest.json",
    "ecpairing_one_point_fail.json",
    "modexp_39936_1_55201_22000.json",
    "ecadd_0-0_1-2_21000_128.json",
    "ecmul_1-2_1_21000_128.json",
    "ecmul_1-2_340282366920938463463374607431768211456_28000_96.json",
    "ecmul_0-3_2_28000_96.json",
    "ecmul_1-2_0_21000_128.json",
    "ecmul_7827-6598_0_21000_128.json",
    "ecmul_0-0_340282366920938463463374607431768211456_28000_80.json",
    "ecpairing_two_point_fail_2.json",
    "ecmul_1-2_9_21000_128.json",
    "ecmul_1-3_9_28000_96.json",
    "ecpairing_perturb_zeropoint_by_field_modulus.json",
    "ecmul_0-3_9935_28000_128.json",
    "ecmul_0-3_9_21000_96.json",
    "modexp_37120_37111_37111_1000000.json",
    "ecmul_1-2_5617_21000_128.json",
    "RevertOpcodeInCreateReturns.json",
    "modexp_modsize0_returndatasize.json",
    "ecmul_1-3_5616_21000_128.json",
    "ecmul_0-3_5617_28000_96.json",
    "ZeroValue_TransactionCALL_ToOneStorageKey_OOGRevert.json",
    "ecmul_1-3_340282366920938463463374607431768211456_21000_96.json",
    "RevertOpcodeWithBigOutputInInit.json",
    "ecmul_1-3_5616_28000_96.json",
    "ecmul_1-3_2_28000_128.json",
    "ecpairing_two_point_match_1.json",
    "delegatecallNonConst.json",
    "ecmul_7827-6598_5616_28000_96.json",
    "ecmul_0-3_340282366920938463463374607431768211456_21000_80.json",

    # byzantium slow
    "LoopCallsDepthThenRevert3.json",
    "LoopCallsDepthThenRevert2.json",
    "LoopCallsDepthThenRevert.json",
    "static_Call50000.json",
    "static_Call50000_ecrec.json",
    "static_Call50000_identity.json",
    "static_Call50000_identity2.json",
    "static_Call50000_rip160.json",
    "static_Call50000_sha256.json",
    "LoopCallsThenRevert.json",
    "LoopDelegateCallsDepthThenRevert.json",
    "recursiveCreateReturnValue.json",
    "static_Call1024PreCalls2.json",
    "Callcode1024BalanceTooLow.json",
    "static_Call1024BalanceTooLow.json",
    "static_Call1024BalanceTooLow2.json",
    "static_Call1024OOG.json",
    "static_Call1024PreCalls3.json",
    "static_Call1024PreCalls.json",
    "static_Call1MB1024Calldepth.json",

    # Homestead recursives
    "ContractCreationSpam.json",
    "Call1024OOG.json",
    "Call1024PreCalls.json",
    "CallRecursiveBombPreCall.json",
    "Delegatecall1024.json",
    "Delegatecall1024OOG.json",
    "JUMPDEST_Attack.json",
    "JUMPDEST_AttackwithJump.json",
    "ABAcalls1.json",
    "ABAcalls2.json",
    "CallRecursiveBomb0.json",
    "CallRecursiveBomb0_OOG_atMaxCallDepth.json",
    "CallRecursiveBomb1.json",
    "CallRecursiveBomb2.json",
    "CallRecursiveBombLog.json",
    "CallRecursiveBombLog2.json",
    "Call1024BalanceTooLow.json",
    # Frontier recursives
    "Callcode1024OOG.json",
    "callcallcodecall_ABCB_RECURSIVE.json",
    "callcallcodecallcode_ABCB_RECURSIVE.json",
    "callcodecallcall_ABCB_RECURSIVE.json",
    "callcodecallcallcode_ABCB_RECURSIVE.json",
    "callcodecallcodecall_ABCB_RECURSIVE.json",
    "callcodecallcodecallcode_ABCB_RECURSIVE.json",
    "callcallcallcode_ABCB_RECURSIVE.json"
  ]
  result = name in allowedFailingGeneralStateTests
